# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with this
# work for additional information regarding copyright ownership.  The ASF
# licenses this file to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
# License for the specific language governing permissions and limitations under
# the License.
#

platform = $platform || RUBY_PLATFORM[/java/] || 'ruby'

if platform == 'java'
	require 'java'
	$CLASSPATH << "target/classes"
	Dir.glob('target/lib/*.jar').each do |jar|
		require jar
	end
	java_import com.slackworks.MavenProject
	
	maven_project = MavenProject.new('pom.xml')
	naether_jar = "naether-#{maven_project.get_version}.jar"
else
	require 'rjb'
	classpath = ["target/classes"]
	Dir.glob('target/lib/*.jar').each do |jar|
		classpath << jar
	end
	java_opts = (ENV['JAVA_OPTS'] || ENV['JAVA_OPTIONS']).to_s.split
	Rjb::load(classpath.join(File::PATH_SEPARATOR), java_opts)
	MavenProject = Rjb::import('com.slackworks.MavenProject')
	maven_project = MavenProject.new
	maven_project.loadPOM('pom.xml')
	naether_jar = "naether-#{maven_project.getVersion()}.jar"
end

Gem::Specification.new do |spec|
  spec.name           = 'naether'
  spec.version        = maven_project.getVersion
  spec.author         = 'Michael Guymon'
  spec.email          = "michael.guymon@gmail.com"
  spec.homepage       = "https://github.com/mguymon/naether"
  spec.summary        = "Java Dependency Resolver"
  spec.description    = <<-TEXT
Java Dependency Resolver for using Maven's Aether
  TEXT
  spec.rubyforge_project  = 'naether'

  # Rakefile needs to create spec for both platforms (ruby and java), using the
  # $platform global variable.  In all other cases, we figure it out from RUBY_PLATFORM.
  spec.platform       = platform
  spec.require_paths = %w[lib]
  spec.files          = ['naether.gemspec', 'LICENSE','README.rdoc','pom.xml', 'lib/naether.rb', naether_jar]

  spec.add_dependency 'rjb',                  '1.3.3' if spec.platform.to_s == 'ruby'
  spec.add_dependency 'rjb',                  '1.3.2' if spec.platform.to_s == 'x86-mswin32'
end
